<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>活动详情</title>
    <link rel="stylesheet" href="http://localhost:8888/css/index.css" type="text/css" />
    <link rel="stylesheet" href="http://localhost:8888/css/header.css" type="text/css" />
    <link rel="stylesheet" href="http://localhost:8888/css/information.css" type="text/css" />
    <link rel="stylesheet" href="http://localhost:8888/css/activity_detail.css" type="text/css" />
    <link rel="stylesheet" href="http://localhost:8888/css/sweet-alert.css" type="text/css"/>
    <script src="http://localhost:8888/js/currentTime.js"></script>
</head>
<body>
    <div class="header">
        <div class="logo">
            <img src="http://localhost:8888/image/logo.png" alt="logo" />
        </div>
        <div class="navigation-bar">
            <ul class="nav-bar-ul">
                <li class="nav-bar-li"><a href="http://localhost:8888/index.html">首页</a></li>
                <li class="nav-bar-li"><a href="http://localhost:8888/index.html?id=1">学术类</a></li>
                <li class="nav-bar-li"><a href="http://localhost:8888/index.html?id=2">科技类</a></li>
                <li class="nav-bar-li"><a href="http://localhost:8888/index.html?id=3">思政类</a></li>
                <li class="nav-bar-li"><a href="http://localhost:8888/index.html?id=4">文艺类</a></li>
                <li class="nav-bar-li"><a href="http://localhost:8888/index.html?id=5">体育类</a></li>
                <li class="nav-bar-li"><a href="http://localhost:8888/index.html?id=6">实践类</a></li>
                <li class="nav-bar-li"><a href="http://localhost:8888/index.html?id=7">公益类</a></li>
                <li class="nav-bar-li"><a href="http://localhost:8888/index.html?id=8">班级类</a></li>
                <li class="nav-bar-li"><a href="http://localhost:8888/index.html?id=9">同乡类</a></li>
            </ul>
        </div>
        <div class="user">
            <ul th:if="${session.username==null}">
                <li ><a href="http://localhost:8888/login.html" id="username">登录</a></li>
                <li ><a href="http://localhost:8888/register.html">注册</a></li>
                <li id="divDate"></li>
                <li>
                    <div id="divWeek"></div>
                    <div id="divTime"></div>
                </li>
            </ul>
            <ul th:if="${session.username!=null}">
                <li style="margin-left:-10px;margin-right:10px;" th:if="${session.headimage==null}"><img src ="http://localhost:8888/image/矩形 107.png" style="width:35px;height:35px;margin-top:8px;" /></li>
                <li style="margin-left:-10px;margin-right:10px;" th:if="${session.headimage!=null}"><img th:src="${session.headimage}" style="width:35px;height:35px;margin-top:8px;" /></li>
                <li ><a href="http://localhost:8888/user_detail.html" th:text="${session.username}" id="username">登录</a></li>
                <li id="divDate"></li>
                <li>
                    <div id="divWeek"></div>
                    <div id="divTime"></div>
                </li>
            </ul>
        </div>
    </div>
    <div class="activity_main">
        <div class="main_header">
            <span th:text="${activity.atitle}">社团之夜</span>
            <ul>
                <li>
                    <span>截止时间：</span>
                    <span th:text="${activity.enddate}">2018-12-12</span>
                </li>
                <li>
                    <span>开始时间：</span>
                    <span th:text="${activity.startdate}">2018-11-12</span>
                </li>
                <li>
                    <span>主办单位：</span>
                    <span th:text="${activity.communityname}">校学生会</span>
                </li>
            </ul>
        </div>
        <img src="http://localhost:8888/image/activity01.png" alt="图片" style="width:100%;" />
        <div class="container_main">
            <div class="label-name" style="position:relative;">              
                    <span>活动简介</span>
                <div class="square_outline" >
                    <div class="square"></div>
                    <div class="square"></div>
                </div>
            </div>
            <div class="activity_introduction">
                <div class="activity_brief">
                    <p th:utext="${activity.activitycontent}">
                    她用纯洁的清泉 灌溉花的国土 她用磅礴的力量 推动新的时代 简简单单的铅笔画 
                    色彩斑斓的水彩画 技术娴熟的图片制作 抑或仅仅是画图、qq涂鸦几笔勾勒出的线条 
                    或写意或绚丽或简洁或繁芜 只要你想 无论何种方式，无论何种元素 用心表达对她的
                    爱她用纯洁的清泉 灌溉花的国土 她用磅礴的力量 推动新的时代 简简单单的铅笔画 
                    色彩斑斓的水彩画 技术娴熟的图片制作 抑或仅仅是画图、qq涂鸦几笔勾勒出的线条 
                    或写意或绚丽或简洁或繁芜 只要你想 无论何种方式，无论何种元素 用心表达对她的
                    爱她用纯洁的清泉 灌溉花的国土 她用磅礴的力量 推动新的时代 简简单单的铅笔画 
                    色彩斑斓的水彩画 技术娴熟的图片制作 抑或仅仅是画图、qq涂鸦几笔勾勒出的线条 
                    或写意或绚丽或简洁或繁芜 只要你想 无论何种方式，无论何种元素 用心表达对她的爱
                    </p>
                </div>
                <div class="activity_image">
                    <img src="http://localhost:8888/image/矩形 110.png" alt="海报1">
                </div>
            </div>

        </div>
        <div class="info_follow">
                <div class="info_follow_img">
                    <ul>
                        <li>
                            <span th:text="${number}">1000</span>
                            <img src="http://localhost:8888/image/information_1.png" alt="查看人数" id="comment"/>
                        </li>
                        <!--<li>-->
                             <!--<span>1000</span>-->
                             <!--<img src="http://localhost:8888/image/information_2.png" alt="点赞人数"/>-->
                         <!--</li> -->
                         <li>
                             <span id="supportnumber">1000</span>
                             <img src="http://localhost:8888/image/information_3.png" alt="点赞人数"  id="comentclick" data_state="not_active"/>
                         </li>
                         <!--<li>-->
                             <!--<span>1000</span>-->
                             <!--<img src="http://localhost:8888/image/information_4.png" alt="评论人数"/>-->
                         <!--</li>-->
                    </ul>
                </div>
          </div>
          <div class="info_form">
             <form method="POST">
               <input type="text" placeholder="我也来说两句" name="comment" class="info_context">
               <button id="submit_btn" type="button" onclick="addComment()">发表评论</button>
             </form>
          </div>
          <div class="information_comment">
              <p>
                  <span class="commentpart">精选评论</span>
                  <span class="commentall">全部评论</span>
              </p>
              <div class="line"></div>
              <ul id="part">
                  <li th:each="item:${comment}">
                     <table class="comment_detail">
                         <tr>
                             <td rowspan="2" class="table_img">
                                 <img th:src="'http://localhost:8888/'+${item.headImage}" alt="用户头像" class="user_phone"/>
                             </td>
                             <td class="username" th:text="${item.username}">zhagntinting</td>
                             <td class="date" th:text="${item.date}">2018-9-12</td>
                             <td class="table_dianzan">
                                 <img src="http://localhost:8888/image/information_3.png" alt="点赞" class="dianzan" data_state="not_active"/>
                                 <a href="javascript:(0);" th:data_aid="${item.aid}" >点赞</a>
                             </td>
                         </tr>
                         <tr> 
                             <td colspan="2" th:text="${item.comment}"></td>
                         </tr>
                     </table>
                  </li>
              </ul>
              <ul id="whole" style="display:none;">

              </ul>
          </div>
    </div>
    <div class="footer" style="float: left;">
    </div>
</body>
<script src="http://localhost:8888/js/jquery-2.2.4.min.js"></script>
<script src="http://localhost:8888/js/sweet-alert.min.js"></script>
<script>
    var aid = "[[${activity.aid}]]";
    var username = "[[${session.username}]]";
    function countByAid(){
        $.ajax({
            url:'http://localhost:8888/countsupport',
            type:'post',
            data:{'aid':aid},
            success:function(result){
                $('#supportnumber').text(result.extend.number);
            }
        })
    };
    countByAid();
    function addSupport(){
        if(username == ''){
            swal('请先登录','','info');
        }else{
            $.ajax({
                url:'http://localhost:8888/addsupport',
                type:'post',
                data:{"aid":aid,"username":username},
                success:function(result){
                    countByAid();
                }
            })
        }
    };
    function addComment(){
        var date = $('#divDate').text();
        var username = "[[${session.username}]]";
        var comment = $('input[name="comment"]').val();
        if(username!='' && comment!=''){
            $.ajax({
                url:'http://localhost:8888/addactivityComment',
                type:'post',
                data:{"aid":aid,"date":date,"username":username,"comment":comment},
                success:function(result){
                     if(result.code == 200){
                         swal("评论成功",'','success');
                         setTimeout(function(){
                             window.location.href="http://localhost:8888/activity_detail/"+aid;
                         },1000);
                     }else{
                         swal('评论失败','','error');
                     }
                }
            })
        }else{
            swal("请用户先登录",'','info')
        }
    };
    $('.commentall').click(function() {
        $(this).css('color','rgba(51,119,236,1)');
        $('.commentpart').css('color','rgba(62,62,62,1)');
        var aid = "[[${activity.aid}]]";
        // console.log(aid);
        $.ajax({
            url:'http://localhost:8888/getAllactivitycomment',
            type:'post',
            data:{"aid":aid},
            success:function(result){
                // console.log(result);
                  Fendering(result.extend.list);
            }
        });
    });
    function Fendering(item){
        var datastr = '';
        $.each(item,function (i,j) {
            datastr +="<li>";
            datastr +="<table class='comment_detail'>";
            datastr +="<tr>";
            datastr +="<td rowspan='2' class='table_img'>";
            datastr +="<img src='http://localhost:8888/"+j.headImage+"' alt='用户头像' class='user_phone'/>";
            datastr +="</td>";
            datastr +="<td class='username' >"+j.username+"</td>";
            datastr +="<td class='date' >"+j.date+"</td>";
            datastr +="<td class='table_dianzan'>";
            datastr +="<img src='http://localhost:8888/image/information_3.png' alt='点赞' class='dianzan dianzan2' data_state='not_active'/>";
            datastr +="<a href='javascript:(0);' >点赞</a>";
            datastr +="</td>";
            datastr +="</tr>";
            datastr +="<tr>";
            datastr +="<td colspan='2'>"+j.comment+"</td>";
            datastr +="</tr>";
            datastr +="</table>";
            datastr +="</li>";
        });
        $('#whole').append(datastr);
        $('#whole').css("display","block");
        $('#part').css("display","none");
    };
    $('#comentclick').click(function(){
        var data_state = $(this).attr("data_state")
        if(username != ''){
            if(data_state == 'not_active'){
                $(this).attr('src','http://localhost:8888/image/zan.png');
                $(this).attr('data_state','active');
                addSupport();
            }else{
                $(this).attr('src','http://localhost:8888/image/information_3.png');
                $(this).attr('data_state','not_active');
                addSupport();
            }
        }else{
            swal('请先登录','','info');
        }
    });
    $('.dianzan').click(function(){
        //data_state="not_active"
        var data_state = $(this).attr("data_state")
        if(data_state == 'not_active'){
            $(this).attr('src','http://localhost:8888/image/zan.png');
            $(this).attr('data_state','active');
        }else{
            $(this).attr('src','http://localhost:8888/image/information_3.png');
            $(this).attr('data_state','not_active');
        }
    })
    $("#whole").on("click",".dianzan2",function () {
        var data_state = $(this).attr("data_state")
        if(data_state == 'not_active'){
            $(this).attr('src','http://localhost:8888/image/zan.png');
            $(this).attr('data_state','active');
        }else{
            $(this).attr('src','http://localhost:8888/image/information_3.png');
            $(this).attr('data_state','not_active');
        }
    });
    $('.commentpart').click(function () {
        $('#whole').css("display","none");
        $('#part').css("display","block");
        $(this).css('color','rgba(51,119,236,1)');
        $('.commentall').css('color','rgba(62,62,62,1)');
    });


</script>
</html>